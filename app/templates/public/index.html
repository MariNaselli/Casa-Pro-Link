{% extends "base.html" %} 
{% block title %}Cat√°logo de Propiedades{% endblock %} 

{% block content %}
<div class="container">
  <div class="row justify-content-center my-5">
    <div class="col-md-6">
      <form action="/" method="GET" class="input-group shadow-sm">
        <input type="text" name="q" class="form-control border-0" placeholder="Buscar..." value="{{ busqueda or '' }}">
        <button class="btn btn-primary" type="submit"><i class="bi bi-search"></i></button>
        {% if busqueda %}<a href="/" class="btn btn-outline-secondary border-0">Limpiar</a>{% endif %}
      </form>
    </div>
  </div>

  <div class="row row-cols-1 row-cols-md-4 g-4 pb-5">
    {% for p in propiedades %}
    <div class="col">
      <div class="card h-100 shadow-sm border-0 position-relative">
        
        {% set img = p.archivos | selectattr('tipo', 'equalto', 'imagen') | first %}
        <img src="{{ url_for('static', filename='uploads/' + img.archivo_nombre) if img else url_for('static', filename='img/no-photo.jpg') }}" 
             class="card-img-top" style="height: 180px; object-fit: cover">

        <div class="position-absolute top-0 end-0 m-2">
          <span class="badge {{ 'bg-success' if p.operacion_rel.nombre == 'Venta' else 'bg-warning text-dark' }}">
            {{ p.operacion_rel.nombre }}
          </span>
        </div>

        <div class="card-body p-3">
          <h6 class="fw-bold mb-1 text-truncate">{{ p.titulo }}</h6>
          <p class="text-muted small mb-2"><i class="bi bi-geo-alt"></i> {{ p.barrio_rel.nombre }}</p>
          <h6 class="text-primary fw-bold mb-0">
            {{ p.moneda }} {{ "{:,.0f}".format(p.precio).replace(',', '.') if p.precio else 'Consultar' }}
          </h6>
        </div>

        <div class="card-footer bg-white border-0 p-3 pt-0">
  <div class="d-flex align-items-center justify-content-between">
    
    {% include 'includes/_acciones.html' %}
    
  </div>
</div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

{% include 'includes/_modal_eliminar.html' %}

{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='js/propiedades.js') }}"></script>
{% endblock %}
